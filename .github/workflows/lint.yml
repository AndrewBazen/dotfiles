name: Lint

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: "./install"
          additional_files: "setup.sh bootstrap/link.sh tools/diagnostic.sh system/aliases.sh"
          severity: warning

  lua-check:
    name: Lua Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check Lua syntax
        run: |
          sudo apt-get update
          sudo apt-get install -y lua5.4
          echo "Checking Lua files..."
          find nvim -name "*.lua" -exec lua5.4 -p {} \;
          echo "✅ All Lua files are valid"

  toml-check:
    name: TOML Syntax
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check TOML syntax
        run: |
          pip install toml
          echo "Checking TOML files..."
          python3 -c "
          import toml
          import sys
          from pathlib import Path

          files = list(Path('.').rglob('*.toml'))
          errors = []
          for f in files:
              try:
                  toml.load(f)
                  print(f'✓ {f}')
              except Exception as e:
                  errors.append(f'{f}: {e}')
                  print(f'✗ {f}: {e}')

          if errors:
              sys.exit(1)
          print('✅ All TOML files are valid')
          "

